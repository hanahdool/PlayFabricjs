<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  <script src = "js/fabric.js"></script>
  <script src = "js/underscore.js"></script>
  <script src = "js/jquery.js"></script>
</head>
<body style="position:absolute">

<!--<div id="editor" ng-show="canvas.getActiveObject()" class="ng-hide">-->
  <!--<label style="margin-left:10px">Color : </label>-->
  <!--<input type="color" id="textColor">-->
<!--</div>-->

<canvas id="canvas" width="800" height="500" style="border: 1px solid black"></canvas>


<br>
<b>테두리</b>
<br>
<hr>


<div id="shadow">
  <b>그림자</b>
  <br>
  흐림(번짐 효과) <input id="blur_range" type="range" min="0" max="100" value="10"/><input id="blur_number" type="number" value="10"/>
  <br>
  오프셋X <input id="offsetX_range" type="range" min="-50" max="50" value="10"/><input id="offsetX_number" type="number" value="10"/>
  <br>
  오프셋Y <input id="offsetY_range" type="range" min="-50" max="50" value="10"/><input id="offsetY_number" type="number" value="10"/>
  <br>
  <del>불투명도</del> <input id="opacity_range" type="range" min="0" max="100" value="50"/><input id="opacity_number" type="number" value="50"/>
  <br>
  그림자 색깔 <input id="color" type="color"/> <!-- 직접 입력할 수도 있게? -->
</div>

<hr>

<div id="opacity">
  <b>불투명도</b>
  <br>
  <input class="range" type="range" min="0" max="100" value="100"/><input class="number" type="number" value="100"/>
</div>

<hr>

<div id="mirror">
  <del><b>반사</b></del>
  <br>
  <input class="range" type="range" min="0" max="100" value="50"/><input class="number" type="number" value="50"/>

</div>


<script>


  var canvas = new fabric.Canvas('canvas');

  canvas.setBackgroundColor("yellow");

  var rect = new fabric.Rect({ width: 100, height: 100, top: 100, left: 100, fill:'rgba(150, 150, 255, 1)' });

  rect.setShadow({
    color: "rgba(0,0,0,0.5)", // 그림자의 불투명도는 적당히 fix 시켜두기? 바꿀때마다.. fix가 되나? - fix 안됨 1로됨 ㅜㅜ// 불투명도 0 ~ 100
    blur: 10, // 0 ~ 100
    offsetX: 10, // -50 ~ 50
    offsetY: 10
  });

/*
  // 그림자 적용 함수 - 어짜피 텍스트 뿐 아니라 모든 객체에 적용 할 것
//  var o = { color: "rgba(1,0,0,0.3)", offsetX: 5, offsetY: 5}

  text.setShadow({
    color: "rgba(255,0,0,0.3)",
    blur: 0, // 주로 0 ~ 20
    offsetX: 5, // 주로 0.00001 ? ~ 20
    offsetY: 5
  });

  text.setShadow("3px 3px 0px rgba(255, 0, 0, 0.5)"); // offsetX, offsetY, blur, color
  // 근데, shadow를 주는 방식은 어떻게 할 건지? - keynote 효과 참고!!!

  canvas.renderAll();


*/


  canvas.add(rect); // 이미지, 텍스트 다 적용해보기
  canvas.setActiveObject(rect);


  /* shadow 이벤트 */

  synchronization('#shadow #blur_range', '#shadow #blur_number');
  synchronization('#shadow #offsetX_range', '#shadow #offsetX_number');
  synchronization('#shadow #offsetY_range', '#shadow #offsetY_number');
  synchronization('#shadow #opacity_range', '#shadow #opacity_number');

  synchronization('#opacity .range', '#opacity .number');
  synchronization('#mirror .range', '#mirror .number');

  function synchronization(a, b) {
    $(a).on("input change", function(e) {
      $(b).val(e.target.value);
    });
    $(b).on("input change", function(e) {
      $(a).val(e.target.value);
    });
  }



  /* 그림자 */
  $('#shadow #blur_range, #shadow #blur_number').on("input change", function(e) {
    canvas.getActiveObject().shadow.blur = e.target.value;
    canvas.renderAll();
  });
  $('#shadow #offsetX_range, #shadow #offsetX_number').on("input change", function(e) {
    canvas.getActiveObject().shadow.offsetX = e.target.value;
    canvas.renderAll();
  });
  $('#shadow #offsetY_range, #shadow #offsetY_number').on("input change", function(e) {
    canvas.getActiveObject().shadow.offsetY = e.target.value;
    canvas.renderAll();
  });

//  $('#shadow #opacity_range, #shadow #opacity_number').on("input change", function(e) {
////    canvas.getActiveObject().shadow.color = e.target.value;
//    var active = canvas.getActiveObject();
////    active.shadow.color = (active.shadow.color).replace(//);
//    // rgba()일 수도, #ffffff 일 수도..  다 변환해가면서 해야하나?ㅜㅜㅜㅜㅜㅜ 255 <-> 16진수 ㅜㅜㅜㅜ
//
//    canvas.renderAll();
//  });

  $('#shadow #color').on("input change", function(e) {
    canvas.getActiveObject().shadow.color = e.target.value;
    canvas.renderAll();
  });


  /* 불투명도 */
  $('#opacity .range, #opacity .number').on("input change", function(e) {
    canvas.getActiveObject().opacity = (e.target.value) * 0.01;
    canvas.renderAll();
  });


</script>

</body>
</html>